# $NetBSD$
#
###########################################################
#                  Generated by fbsd2pkg                  #
#              Thu Jul 20 18:34:44 CDT 2017               #
###########################################################

DISTNAME=	canu-${PORTVERSION}
CATEGORIES=	biology java
MASTER_SITES=	${MASTER_SITE_GITHUB:=marbl/}
GITHUB_PROJECT=	canu
GITHUB_TAG=	v${PORTVERSION}

MAINTAINER=	bacon4000@gmail.com
HOMEPAGE=	http://canu.readthedocs.io/
COMMENT=	Single molecule sequence assembler for genomes large and small

# Check this
LICENSE=	gnu-gpl-v2

# Screwy Makefile compiles directly into ${DESTDIR}${PREFIX}
SUBST_CLASSES+=		optimize
SUBST_STAGE.optimize=	post-patch
SUBST_SED.optimize+=	-e 's|-O4|-O2|g'
SUBST_SED.optimize+=	-e 's|-funroll-loops||g'
SUBST_SED.optimize+=	-e 's|-fexpensive-optimizations||g'
SUBST_FILES.optimize+=	${WRKSRC}/Makefile

REPLACE_PERL+=	bogart/plotErrorProfile.pl \
		bogart/findOverlappingReads.pl \
		pipelines/simple-repeat-test.pl \
		pipelines/canu-object-store.pl \
		pipelines/canu.pl \
		pipelines/bogart-sweep.pl \
		bogus/bogusness-run.pl \
		bogart-analysis/analyze-nucmer-gaps.pl \
		bogart-analysis/examine-mapping.pl \
		bogart-analysis/bogart-build-fasta.pl \
		bogart-analysis/examine-mapping-ideal.pl \
		bogart-analysis/count-bubbles.pl \
		bogart-analysis/locate-read-in-unitig-based-on-olaps.pl \
		bogart-analysis/analyze-mapped-unitigs-for-joins.pl \
		bogart-analysis/show-false-best-edges-from-mapping.pl \
		overlapBasedTrimming/detect-unsplit-subreads-in-overlaps.pl \
		overlapBasedTrimming/test-random-chimeric-fragments.pl \
		overlapBasedTrimming/generate-random-chimeric-fragments.pl \
		overlapInCore-analysis/infer-ovl-from-genomic-blasr.pl \
		overlapInCore-analysis/infer-obt-from-genomic-blasr.pl \
		overlapInCore-analysis/infer-olaps-from-pairwise-coords.pl \
		overlapInCore-analysis/find-missed-true-overlaps.pl \
		overlapInCore-analysis/infer-olaps-from-genomic-coords.pl \
		overlapInCore-analysis/analyze-true-vs-test.pl \
		overlapInCore-analysis/filterTrue.pl \
		overlapInCore-analysis/infer-olaps-from-pairwise-blasr.pl \
		overlapInCore-analysis/check-ordered-reads-for-missed-overlaps.pl \
		merTrim/merTrim-compare-logs.pl \
		erateEstimate/erate-estimate-test-based-on-mapping.pl \
		erateEstimate/erate-estimate-plot-per-base-estimate.pl \
		canu_version_update.pl \
		meryl/gkrpt.pl \
		fastq-utilities/fastqSimulate-checkCoverage.pl \
		fastq-utilities/fastqSimulate-perfectSep.pl \
		addCopyrights-BuildData.pl \
		addCopyrights.pl

# May work on other 64-bit processors, but untested
ONLY_FOR_PLATFORM=	 *-*-x86_64

USE_LANGUAGES=	c c++
USE_JAVA=	run
USE_TOOLS+=	gmake pax perl

GCC_REQD+=	4.8

WRKSRC=		${WRKDIR}/canu-${PORTVERSION}/src

MAKE_ENV+=	DESTDIR=${WRKSRC}

PORTVERSION=	1.5

INSTALLATION_DIRS=	canu-${PORTVERSION}/bin

# FIXME: Unravel the willy-nilly directory structure.
do-install:
	cd ${WRKSRC}${PREFIX}/${OPSYS}-${MACHINE_ARCH:S/x86_64/amd64/}/bin && \
		${PAX} -wr * ${DESTDIR}${PREFIX}/canu-${PORTVERSION}/bin

.include "../../devel/boost-libs/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
