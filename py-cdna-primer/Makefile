# $NetBSD$

###########################################################
#               Generated by fbsd2pkg                     #
###########################################################

DISTNAME=	cDNA_primer-${PORTVERSION}
PKGNAME=	${PYPKGPREFIX}-cDNA_primer-${PORTVERSION}
CATEGORIES=	python
MASTER_SITES=	http://www.acadix.biz/Ports/distfiles/
EXTRACT_SUFX=	.tar.xz

MAINTAINER=	bacon4000@gmail.com

COMMENT=	Analyzing transcriptome data generated using the PacBio(R)
#LICENSE=	

DEPENDS+=	${PYPKGPREFIX}-networkx>=1.9:../../math/py-networkx \
		${PYPKGPREFIX}-scipy>=0.15.1:../../math/py-scipy \
		hmmer>=3.0:../../biology/hmmer

# Pessimistic assumption.  Test and change if possible.
MAKE_JOBS_SAFE=	no

# Just assuming C and C++: Adjust this!
USE_LANGUAGES=	c c++
PYDISTUTILSPKG=	yes
REPLACE_PYTHON=	pbtools/pbtranscript/cleanup_ice.py \
		pbtools/pbtranscript/collapse_isoforms_by_sam.py \
		pbtools/pbtranscript/fusion_finder.py \
		pbtools/pbtranscript/ice_fa2fq.py \
		pbtools/pbtranscript/ice_partial.py \
		pbtools/pbtranscript/ice_pbdagcon.py \
		pbtools/pbtranscript/ice_quiver.py \
		pbtools/pbtranscript/pbtranscript.py \
		pbtools/pbtranscript/picking_up_ice.py \
		pbtools/pbtranscript/tofu_wrap.py \

WRKSRC=		${WRKDIR}/cDNA_primer-${PORTVERSION}/pbtranscript-tofu/pbtranscript

PORTNAME=	cDNA_primer
PORTVERSION=	2015.08.17

# Using bundled daligner and dazz_db for now
#		daligner>=${PORTVERSION}:/usr/wip/biology/daligner \
# FIXME: Do we need the modified daligner described here?
# https://github.com/PacificBiosciences/cDNA_primer/wiki/Setting-up-virtualenv-and-installing-pbtranscript-tofu
pre-build:
		cd ${WRKSRC}/pbtools/pbtranscript/branch/C && \
			${PYTHONBIN} setup2.py build_ext --inplace
		cd ${WRKSRC}/../external_daligner && unzip DALIGNER-d4aa4871122b35ac92e2cc13d9b1b1e9c5b5dc5c-ICEmod.zip && cd DALIGNER-d4aa4871122b35ac92e2cc13d9b1b1e9c5b5dc5c-ICEmod && sed -e 's|gcc|${CC}|g' Makefile && ${MAKE} clean && ${MAKE}
		cd ${WRKSRC}/../external_daligner && unzip DAZZ_DB-40bb7e4b2041cdfd3c50b22201301b8df06342fa.zip && cd DAZZ_DB-40bb7e4b2041cdfd3c50b22201301b8df06342fa && sed -e 's|gcc|${CC}|g' Makefile && ${MAKE} clean && ${MAKE}

post-install:
		${MKDIR} ${DESTDIR}${PREFIX}/${PORTNAME}/bin
		${MV} ${DESTDIR}${PREFIX}/bin/pbtranscript.py \
			${DESTDIR}${PREFIX}/${PORTNAME}/bin
		cd ${WRKSRC}/../external_daligner/DALIGNER-d4aa4871122b35ac92e2cc13d9b1b1e9c5b5dc5c-ICEmod && ${INSTALL_PROGRAM} HPCdaligner HPCmapper LA4Ice LAcat LAcheck LAmerge LAshow LAsort LAsplit daligner ${DESTDIR}${PREFIX}/${PORTNAME}/bin
		cd ${WRKSRC}/../external_daligner/DAZZ_DB-40bb7e4b2041cdfd3c50b22201301b8df06342fa && ${INSTALL_PROGRAM} Catrack DAM2fasta DB2fasta DB2quiva DBdust DBrm DBshow DBsplit DBstats fasta2DAM fasta2DB quiva2DB simulator ${DESTDIR}${PREFIX}/${PORTNAME}/bin
		${CHMOD} -R a+rX ${DESTDIR}${PREFIX}/${PYSITELIB}/pbtools/pbtranscript/data/

.include "../../lang/python/distutils.mk"
.include "../../devel/py-cython/buildlink3.mk"
.include "../../jb-wip/py-pbh5tools/buildlink3.mk"
# Is this the right place for this dep?
.include "../../wip/blasr/buildlink3.mk"
.include "../../jb-wip/pbdagcon/buildlink3.mk"
.include "../../math/py-numpy/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
