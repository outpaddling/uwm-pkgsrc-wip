# $NetBSD$

###########################################################
#               Generated by fbsd2pkg                     #
###########################################################

# FIXME: blasr_libcpp's Types.h is very common and could cause collisions
# Same for libconfig.h

DISTNAME=	pbdagcon-${PORTVERSION}
CATEGORIES=	biology
MASTER_SITES=	http://acadix.biz/Ports/distfiles/
EXTRACT_SUFX=	.tar.xz

MAINTAINER=	bacon4000@gmail.com

COMMENT=	Consensus algorithm implementation based on directed acyclic graphs
# Double-check this
LICENSE=	modified-bsd

# Pessimistic assumption.  Test and change if possible.
MAKE_JOBS_SAFE=	no

# Just assuming C and C++: Adjust this!
USE_LANGUAGES=	c c++
USE_TOOLS+=	gmake
REPLACE_BASH=	src/cpp/pbdagcon_wf.sh
REPLACE_PYTHON=	configure.py \
		src/filterm4.py \
		src/m4topre.py \
		src/q-sense.py \
		src/tests/test_aligngraph.py

DEPENDS+=	${PYPKGPREFIX}-argparse>=0:../../devel/py-argparse

SUBST_CLASSES+=		bash
SUBST_STAGE.bash=	post-patch
SUBST_FILES.bash=	${WRKSRC}/makefile
SUBST_SED.bash=		-e 's|/bin/bash|${LOCALBASE}/bin/bash|g'

SUBST_CLASSES+=		libs
SUBST_STAGE.libs=	post-patch
SUBST_FILES.libs=	${WRKSRC}/configure.py
SUBST_SED.libs=		-e 's|-lblasr|-lblasr -lhdf5_cpp -lhdf5 -ldaligner -ldazzdb|g' \
			-e 's|$${DALIGNER_SRC}|$${LOCALBASE}/include|g' \
			-e 's|$${DAZZ_DB_SRC}|$${LOCALBASE}/include|g'

SUBST_CLASSES+=		flags
SUBST_STAGE.flags=	post-patch
SUBST_FILES.flags=	${WRKSRC}/src/cpp/makefile
SUBST_SED.flags=	-e 's|CXXFLAGS =|CXXFLAGS +=|g' \
			-e 's|CFLAGS =|CFLAGS +=|g' \
			-e 's|c++11|c++0x|g' \
			-e 's|DB.o QV.o align.o ||g' \
			-e 's|^vpath|\# vpath|g'

# C++11
#SUBST_CLASSES+=		nullptr
#SUBST_STAGE.nullptr=	post-patch
#SUBST_FILES.nullptr=	${WRKSRC}/src/cpp/third-party/easylogging++.h
#SUBST_SED.nullptr=	-e 's|nullptr|0|g'

CXXFLAGS+=	-I${LOCALBASE}/include \
		-I${LOCALBASE}/include/blasr_libcpp \
		-I${LOCALBASE}/include/blasr_libcpp/alignment \
		-I${LOCALBASE}/include/blasr_libcpp/pbdata
MAKE_FILE=	makefile
GCC_REQD=	4.9 4.8 4.7	# C++11

PORTVERSION=	2015.08.19
DATADIR=	${PREFIX}/share/pbdagcon
DOCSDIR=	${PREFIX}/share/doc/pbdagcon

# Sets OPSYS, OS_VERSION, MACHINE_ARCH, etc..
#.include "../../mk/bsd.prefs.mk"

# Keep this if there are user-selectable options.
#.include "options.mk"

# You may need this, especially if using do-install.
# Note: Depends on PLIST.
#AUTO_MKDIRS=	yes

do-configure:
	cd ${WRKSRC} && ./configure.py --no-pbbam

do-install:
	${MKDIR} ${DESTDIR}${PREFIX}/bin
	${INSTALL_PROGRAM} \
		${WRKSRC}/src/cpp/pbdagcon \
		${WRKSRC}/src/cpp/dazcon \
		${DESTDIR}${PREFIX}/bin
	${INSTALL_SCRIPT} \
		${WRKSRC}/src/cpp/pbdagcon_wf.sh \
		${DESTDIR}${PREFIX}/bin

.include "../../lang/python/application.mk"
.include "../../wip/blasr_libcpp/buildlink3.mk"
.include "../../uwm-pkgsrc-wip/dazz_db/buildlink3.mk"
.include "../../uwm-pkgsrc-wip/daligner/buildlink3.mk"
# .include "../../devel/boost-libs/buildlink3.mk"
.include "../../devel/boost-headers/buildlink3.mk"
.include "../../devel/hdf5-c++/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
