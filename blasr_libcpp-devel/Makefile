# $NetBSD$
#
###########################################################
#                  Generated by fbsd2pkg                  #
#              Tue Sep 13 14:55:55 CDT 2016               #
###########################################################

DISTNAME=	${PORTNAME}-${PORTVERSION}
CATEGORIES=	biology
MASTER_SITES=	${MASTER_SITE_GITHUB:=PacificBiosciences/}
GITHUB_PROJECT=	${PORTNAME}
GITHUB_TAG=	c7d95cc8aec85ccb85161b67a613413c9ceee3cf

MAINTAINER=	bacon4000@gmail.com
HOMEPAGE=	https://github.com/PacificBiosciences/blasr_libcpp
COMMENT=	Library for analyzing PacBio sequences
LICENSE=	modified-bsd

DEPENDS+=	bash>=0:../../shells/bash

# Caution: This follows a static patch.  Be careful to generate a new patch
# without this substitution.
REPLACE_PYTHON=	configure.py

SUBST_CLASSES+=		uint
SUBST_STAGE.uint=	post-patch
SUBST_SED.uint+=	-e 's|SAIndex, UINT_MAX|SAIndex, INT_MAX|g'
SUBST_FILES.uint+=	${WRKSRC}/alignment/suffixarray/SuffixArray.hpp

SUBST_CLASSES+=		bash
SUBST_STAGE.bash=	post-patch
SUBST_SED.bash+=	-e 's|/bin/bash|${PREFIX}/bin/bash|g'
SUBST_FILES.bash+=	${WRKSRC}/makefile

# Uncomment to build without pbbam support
#SUBST_CLASSES+=		pbbam
#SUBST_STAGE.pbbam=	post-configure
#SUBST_SED.pbbam+=	-e 's|define|undef|'
#SUBST_FILES.pbbam+=	${WRKSRC}/pbdata/libconfig.h

# Just assuming C and C++: Adjust this!
USE_LANGUAGES=	c c++
USE_TOOLS+=	gmake
GCC_REQD=	4.9

WRKSRC=		${WRKDIR}/${PORTNAME}-${GITHUB_TAG}

CXXFLAGS+=	-I${PREFIX}/include
MAKE_FILE=	makefile

PORTVERSION=	2016.09.07

# Specify which directories to create before install.
# You should only need this if using your own install target.
INSTALLATION_DIRS=	bin include lib ${PKGMANDIR}/man1 share/doc share/examples

PORTNAME=	blasr_libcpp

do-configure:
	cd ${WRKSRC} && ./configure.py --no-pbbam \
		HDF5_INCLUDE=${PREFIX}/include HDF5_LIB=${PREFIX}/lib

# FIXME: Find out which headers actually need to be installed
do-install:
	${MKDIR} ${DESTDIR}${PREFIX}/include ${DESTDIR}${PREFIX}/lib
	cd ${WRKSRC} && for fn in `find . -name '*.h' -o -name '*.hpp'`; do \
		dir=`dirname $$fn | cut -d / -f 2-`; \
		${MKDIR} ${DESTDIR}${PREFIX}/include/${PORTNAME}/$$dir; \
		${INSTALL_DATA} $$fn ${DESTDIR}${PREFIX}/include/${PORTNAME}/$$dir; \
	done
	for fn in `find ${WRKSRC} -name '*.a'`; do \
		${INSTALL_DATA} $$fn ${DESTDIR}${PREFIX}/lib; \
	done

.include "../../lang/python/application.mk"
.include "../../wip/pbbam/buildlink3.mk"
.include "../../devel/hdf5/buildlink3.mk"
.include "../../jb-wip/hdf5-c++/buildlink3.mk"
.include "../../devel/boost-libs/buildlink3.mk"
.include "../../wip/htslib/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
