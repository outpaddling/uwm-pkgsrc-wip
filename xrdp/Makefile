# $NetBSD$
#
###########################################################
#                  Generated by fbsd2pkg                  #
#              Wed Apr 19 10:41:12 CDT 2017               #
###########################################################

###########################################################
# Unconverted and partially converted FreeBSD port syntax:

## Created by: alepulver
## $FreeBSD: head/net/xrdp/Makefile 426131 2016-11-14 19:06:32Z rene $
#PORTEPOCH=	1
#LICENSE_FILE=	${WRKSRC}/COPYING
# Unknown tool: USE_TOOLS=	autoreconf:build
#USE_LDCONFIG=	${PREFIX}/lib/xrdp
#USE_RC_SUBR=	xrdp
#USE_XORG=	x11 xfixes
#CPPFLAGS+=	-I${PREFIX}/include
#LIBS+=		-L${PREFIX}/lib
#SUB_FILES=	pkg-message
#OPTIONS_DEFINE=	DEBUG
#OPTIONS_DEFAULT=	JP106 X11RDP
#OPTIONS_GROUP=	KEYMAP XSERVER
#OPTIONS_GROUP_KEYMAP=	JP106
#OPTIONS_GROUP_XSERVER=	X11RDP
#OPTIONS_RADIO=	XVNC
#OPTIONS_RADIO_XVNC=	TIGERVNC TIGHTVNC TRIDIAVNC
#TIGERVNC_DESC=	Use TigerVNC (recommended)
#TIGHTVNC_DESC=	Use TightVNC
#TRIDIAVNC_DESC=	Use TridiaVNC
#X11RDP_DESC=	Use X11rdp (most recommended)
#JP106_DESC=	Install Japanese JP106 keymap
## Debug
#DEBUG_CONFIGURE_ENABLE=	xrdpdebug
## Xvnc
# TIGERVNC_RUN_DEPENDS=	Xvnc:net/tigervnc
# TIGHTVNC_RUN_DEPENDS=	Xvnc:net/tightvnc
# TRIDIAVNC_RUN_DEPENDS=	Xvnc:net/tridiavnc
## X11rdp
# X11RDP_RUN_DEPENDS=	X11rdp:x11-servers/x11rdp
#X11RDP_EXTRA_PATCHES=	${FILESDIR}/extra-patch-x11rdp_xrdp.ini
## JP106 keymap
#JP106_PLIST_SUB=	JP106=""
#JP106_PLIST_SUB_OFF=	JP106="@comment "
#.include <bsd.port.options.mk>
#.if ${PORT_OPTIONS:MJP106}
#KEYMAP_FILES+=	km-0411.ini km-e0010411.ini \
#		km-e0200411.ini km-e0210411.ini
#.endif
#post-patch:
#.for f in sesman/sesman.ini sesman/startwm.sh xrdp/rsakeys.ini xrdp/xrdp.ini
#	@${MV} ${WRKSRC}/$f ${WRKSRC}/$f.sample
#.endfor
#pre-configure:
#	@cd ${WRKSRC} && ./bootstrap
#post-install:
#.for f in ${KEYMAP_FILES}
#	${INSTALL_DATA} ${FILESDIR}/$f ${DESTDIR}${PREFIX}/etc/xrdp
#.endfor
#.include <bsd.port.mk>

DISTNAME=	xrdp-${PORTVERSION}

PKGNAME=	xrdp-${PORTVERSION}
DIST_SUBDIR=	xrdp
CATEGORIES=	net
MASTER_SITES=	${MASTER_SITE_GITHUB:=neutrinolabs/}
GITHUB_PROJECT=	xrdp
GITHUB_TAG=	v${PORTVERSION}

MAINTAINER=	dsiercks@uwm.edu
HOMEPAGE=	http://www.xrdp.org/
COMMENT=	Open source Remote Desktop Protocol (RDP) server
# Check this
LICENSE=	gnu-gpl-v2

# Test and change if necessary.
# MAKE_JOBS_SAFE=	no

# Just assuming C and C++: Adjust this!
USE_LANGUAGES=	c c++
USE_TOOLS+=	pkg-config autoconf automake gmake
USE_LIBTOOL=	yes
GNU_CONFIGURE=	yes

MAKE_ENV=	INSTALL_LIB="${INSTALL_LIB}" \
 		INSTALL_DATA="${INSTALL_DATA}" \
 		INSTALL_PROGRAM="${INSTALL_PROGRAM}" \
 		INSTALL_DIR="${MKDIR}"

pre-configure:
	cd ${WRKSRC} && ./bootstrap

post-patch:
.	for f in sesman/sesman.ini sesman/startwm.sh xrdp/rsakeys.ini xrdp/xrdp.ini
		@${CP} ${WRKSRC}/$f ${WRKSRC}/$f.sample
.	endfor

CONFIGURE_ARGS=	--localstatedir=/var

PORTVERSION=	0.6.2
DATADIR=	${PREFIX}/share/xrdp
DOCSDIR=	${PREFIX}/share/doc/xrdp
EXAMPLESDIR=	${PREFIX}/share/examples/xrdp

DEPENDS+=	tigervnc>=1:../../uwm-pkgsrc-wip/tigervnc

#WRKSRC=			${WRKDIR}/xrdp
EGDIR=			${PREFIX}/share/examples/xrdp
AUTO_MKDIRS=		yes
MAKE_DIRS=		share/examples/pam.d
INSTALLATION_DIRS=	share/xrdp share/examples/xrdp


#PKG_SYSCONFSUBDIR=	xrdp
#CONF_FILES+=		${EGDIR}/sesman.ini	${PKG_SYSCONFDIR}/sesman.ini
#CONF_FILES+=		${EGDIR}/rsakeys.ini	${PKG_SYSCONFDIR}/rsakeys.ini
#CONF_FILES+=		${EGDIR}/xrdp.ini	${PKG_SYSCONFDIR}/xrdp.ini


SUBST_CLASSES+=		paths
SUBST_MESSAGE.paths=	Fixing hardcoded paths
SUBST_STAGE.paths=	post-patch
SUBST_FILES.paths=	sesman/env.c
SUBST_VARS.paths=	PREFIX

# Sets OPSYS, OS_VERSION, MACHINE_ARCH, etc..
# .include "../../mk/bsd.prefs.mk"

# Keep this if there are user-selectable options.
# .include "options.mk"

# Specify which directories to create before install.
# You should only need this if using your own install target.
INSTALLATION_DIRS=	bin include lib ${PKGMANDIR}/man1 share/doc share/examples

# Convert any _DEPENDS above that have a buildlink3.mk
# .include "../..///buildlink3.mk"
.include "../../security/openssl/buildlink3.mk"
# Linux doesn't have zlib in the base, so just in case...
.include "../../security/openssl/buildlink3.mk"
.include "../../mk/pthread.buildlink3.mk"
.include "../../mk/pam.buildlink3.mk"
.include "../../mk/dlopen.buildlink3.mk"
.include "../../x11/libX11/buildlink3.mk"
.include "../../x11/libXfixes/buildlink3.mk"
.include "../../devel/zlib/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
