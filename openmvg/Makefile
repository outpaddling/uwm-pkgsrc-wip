# $NetBSD$
#
###########################################################
#                  Generated by fbsd2pkg                  #
#              Wed Nov  2 10:32:36 CDT 2016               #
###########################################################

###########################################################
# Unconverted and partially converted FreeBSD port syntax:

## Created by: Dan Siercks <dsiercks@uwm.edu>
## $FreeBSD$
## FIXME: Hack around need for recursive git pull
# BUILD_DEPENDS=	eigen>=3:math/eigen3 \
#		liblemon>0:/usr/wip/science/liblemon
# LIB_DEPENDS=	libpng.so:graphics/png \
#		libtiff.so:graphics/tiff \
#		libXxf86vm.so:x11/libXxf86vm \
#		libXi.so:x11/libXi \
#		libXrandr.so:x11/libXrandr \
#		libClp.so:math/clp \
#		libglog.so:devel/glog \
#		libceres.so:math/ceres-solver \
#		libflann_cpp.so:/usr/wip/science/flann
## Alternative to clp
## FIXME: Will try to link to coinmp if present. Installed as a libreoffice dep.
##		libCoinMP.so:math/coinmp \
# Note: cmake:outsource
# Unknown tool: USE_TOOLS=	compiler:c++11-lang
# Unknown tool: USE_TOOLS=	fortran
# Unknown tool: USE_TOOLS=	jpeg
#USE_QT4=	corelib gui
#CMAKE_SOURCE_PATH=	${WRKSRC}/src
## Compiler flag optimizer crashes clang and can't be used for package
## building anyway.
#post-patch:
# 	${REINPLACE_CMD} \
# 		-e '/OptimizeForArchitecture/d' \
# 		-e 's|-O3|-O2|g' \
# 		${WRKSRC}/src/CMakeLists.txt

# Best guess translation of REINPLACE above.  Replace 1 with a
# meaningful name.  Assuming post-patch: Change if necessary.
#SUBST_CLASSES+=		1
#SUBST_STAGE.1=	post-patch
#SUBST_SED.1+=	-e '/OptimizeForArchitecture/d'
#SUBST_SED.1+=	-e 's|-O3|-O2|g'
#SUBST_FILES.1+=	${WRKSRC}/src/CMakeLists.txt

#.include <bsd.port.mk>

DISTNAME=	openmvg-${PORTVERSION}
CATEGORIES=	graphics
MASTER_SITES=	http://acadix.biz/Ports/distfiles/
EXTRACT_SUFX=	.tar.xz

MAINTAINER=	dsiercks@uwm.edu
HOMEPAGE=	http://example.com
COMMENT=	Open Multiple View Geometry library
# LICENSE=	MPL

# Test and change if necessary.
# MAKE_JOBS_SAFE=	no

DEPENDS+=	ceres-solver:../../jb-wip/ceres-solver \
		liblemon:../../jb-wip/liblemon \
		flann:../../jb-wip/flann

# Just assuming C and C++: Adjust this!
USE_LANGUAGES=	c c++
USE_CMAKE=	yes
CMAKE_SOURCE_PATH=	${WRKDIR}/${DISTNAME}/build
CMAKE_ARG_PATH=		${WRKDIR}/${DISTNAME}/src
#CMAKE_ARGS=	-DEIGEN_INCLUDE_DIR_HINTS:STRING=${LOCABASE}/include/eigen3

#CMAKE_SOURCE_PATH=     ${WRKSRC}/src
#CMAKE_SOURCE_PATH=	${WRKDIR}/${DISTNAME}/src
#BUILD_WRKSRC=	${WRKSRC}/src

# Check this
CMAKE_ARGS+=	-DEIGEN_INCLUDE_DIR_HINTS:STRING=${PREFIX}/include/eigen3 \
		-DCLP_INCLUDE_DIR_HINTS:STRING=${PREFIX}/include/coin \
		-DCOINUTILS_INCLUDE_DIR_HINTS:STRING=${PREFIX}/include/coin/ \
		-DOSI_INCLUDE_DIR_HINTS:STRING=${PREFIX}/include/coin \
		-DLEMON_INCLUDE_DIR_HINTS:STRING=${PREFIX}/include/lemon \
		-DFLANN_INCLUDE_DIR_HINTS:STRING=${PREFIX}/include/flann

CXXFLAGS+=	-Wno-deprecated-register
GCC_REQD=	4.9 4.8 4.7

PORTVERSION=	2016.09.06
DATADIR=	${PREFIX}/share/openmvg
DOCSDIR=	${PREFIX}/share/doc/openmvg
EXAMPLESDIR=	${PREFIX}/share/examples/openmvg

# Sets OPSYS, OS_VERSION, MACHINE_ARCH, etc..
# .include "../../mk/bsd.prefs.mk"

# Keep this if there are user-selectable options.
# .include "options.mk"

# Specify which directories to create before install.
# You should only need this if using your own install target.
INSTALLATION_DIRS=	bin include lib ${PKGMANDIR}/man1 share/doc share/examples

# Convert any _DEPENDS above that have a buildlink3.mk
# .include "../..///buildlink3.mk"
# Linux doesn't have zlib in the base, so just in case...
.include "../../math/coinmp/buildlink3.mk"
.include "../../math/eigen3/buildlink3.mk"
.include "../../math/lapack/buildlink3.mk"
.include "../../math/blas/buildlink3.mk"
.include "../../graphics/png/buildlink3.mk"
.include "../../graphics/tiff/buildlink3.mk"
.include "../../x11/libXxf86vm/buildlink3.mk"
.include "../../x11/libXi/buildlink3.mk"
.include "../../x11/libXrandr/buildlink3.mk"
.include "../../devel/google-glog/buildlink3.mk"
.include "../../devel/zlib/buildlink3.mk"
.include "../../jb-wip/flann/buildlink3.mk"
.include "../../jb-wip/ceres-solver/buildlink3.mk"
.include "../../jb-wip/liblemon/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
