# $NetBSD$

###########################################################
#               Generated by fbsd2pkg                     #
###########################################################

DISTNAME=	stm32flash-2011.05.30
CATEGORIES=	devel
MASTER_SITES=	http://acadix.biz/Ports/distfiles/

MAINTAINER=	bacon@NetBSD.org

COMMENT=	Open source flash program for STM32 ARM processors using ST bootloader
#LICENSE=	

# Pessimistic assumption.  Test and change if possible.
MAKE_JOBS_SAFE=	no

# Just assuming C and C++: Adjust this!
USE_LANGUAGES=	c c++
USE_TOOLS+=	gmake

# Adapt REINPLACE commands to SUBST:
SUBST_CLASSES+=		baud
SUBST_STAGE.baud+=	post-patch
SUBST_FILES.baud+=	${WRKSRC}/main.c
SUBST_SED.baud+=	's|57600|115200|g'

.include "../../mk/bsd.prefs.mk"

# Change default device.  Not critical: can be overridden on command-line.
SUBST_CLASSES+=		device
SUBST_STAGE.device+=	post-patch
SUBST_FILES.device+=	${WRKSRC}/main.c
.if ${OPSYS} == FreeBSD
SUBST_SED.device+=	's|ttyS0|cuaU0|g'
.elif ${OPSYS} == Darwin
SUBST_SED.device+=	's|ttyS0|cuaU0|g'
.else
# Dummy subst for Linux and unknown OSs
SUBST_SED.device+=	's|ttyS0|ttyS0|g'
.endif

DATADIR=	${PREFIX}/share/stm32flash
DOCSDIR=	${PREFIX}/share/doc/stm32flash

post-patch:
	${RM} ${WRKSRC}/parsers/parsers.a

do-install:
	${MKDIR} ${DESTDIR}${PREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/stm32flash ${DESTDIR}${PREFIX}/bin

.include "../../mk/bsd.pkg.mk"
